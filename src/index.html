<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="stylesheet" href="./css/style.css"> -->
    <title>chatroom</title>
</head>
<body>

    <div class="container">
        <div class="chat-box">
            <div class="messages">
                
                <ul class="msg-list" id="msg-list"> </ul>
            </div>
            <div class="sender-input">
                <form action="" id="form">
                    <input type="text" id="msg" placeholder="message goes here...">
                    <button type="submit">send</button>
                </form>
            </div>
        </div>
        <div class="users">
            <h3>users in this room</h3>
            <ul class="user-list">
                <li>pawan</li>
                <li>ankush</li>
                <li>shubham</li>
                <li>sagar</li>
                <li>sanjay</li>
            </ul>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.5.3/socket.io.min.js" integrity="sha384-WPFUvHkB1aHA5TDSZi6xtDgkF0wXJcIIxXhC6h8OT8EH3fC5PWro5pWJ1THjcfEi" crossorigin="anonymous"></script>
    <script>

        // const socket = io('http://localhost:4000');
        const socket = io();
        const form = document.getElementById('form');
        const messageBody = document.querySelector('.messages');

        //output message to DOM
        const outputMessage = (message) => {
            const list = document.createElement('li');
            list.classList.add('list-item');
            list.innerHTML = `
                        <p class="meta"> ${message.username} <span> ${message.time} </span> </p>
                        <P class="text">${message.text}</P>
            `;
            document.getElementById('msg-list').appendChild(list);
        }

        socket.on('message', (message) => {
            console.log("send by the server: " + message.text);
            outputMessage(message);

            //scroll to top
            messageBody.scrollTop = messageBody.scrollHeight;
        });

        //listening for submit event when user will send chat
        form.addEventListener('submit', (event) => {
            event.preventDefault()

            //catching chat-message from the input box
            const chatMessageBox = document.getElementById('msg');
            const chatMessage = chatMessageBox.value;

            //emitting chatMessage to server
            socket.emit('sendChatMessage', chatMessage);

            //clear input box and focus
            chatMessageBox.value = "";
            chatMessageBox.focus();
        });

    </script>

</body>
</html>